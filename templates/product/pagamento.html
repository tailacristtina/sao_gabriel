{% include 'nav.html' %}
{% block content %}

<h2 class="text-center text-xl font-semibold mb-4">Finalizar Pagamento</h2>
<p class="text-center">Total: <strong>R$ {{ total_compra|floatformat:2 }}</strong></p>

<script src="https://sdk.mercadopago.com/js/v2"></script>
<div id="wallet_container" class="mt-6 flex justify-center"></div>

<script>
    // üö® CR√çTICO: Substitua "SUA_PUBLIC_KEY_AQUI" pela chave p√∫blica do Mercado Pago
    const mp = new MercadoPago("SUA_PUBLIC_KEY_AQUI", { locale: "pt-BR" });
    mp.bricks().create("wallet", "wallet_container", {
        initialization: {
            // üö® CORRE√á√ÉO 2: A view envia preference_id como vari√°vel de contexto
            preferenceId: "{{ mp_preference_id }}", 
        },
        customization: {
            texts: {
                action: 'buy',
                value_prop: 'security_details',
            },
        },
    });
</script>

{% endblock %}