<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Carrinho de Compras</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    table { border-collapse: collapse; width: 70%; margin: auto; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    th { background: #eee; }
    h1 { text-align: center; }
    .total { font-weight: bold; font-size: 1.2em; text-align: right; margin-top: 20px; }
  </style>
</head>
<body>
 <h2>ðŸ›’ Carrinho de Compras</h2>

    {% if itens %}
      <div class="overflow-x-auto">
        <table class="min-w-full border border-[#e8dfd3] rounded-xl overflow-hidden">
          <thead class="bg-[#4b2e1e] text-white uppercase text-sm tracking-wide">
            <tr>
              <th class="py-3 px-4 text-left">Produto</th>
              <th class="py-3 px-4 text-left">Quantidade</th>
              <th class="py-3 px-4 text-left">Subtotal</th>
              <th class="py-3 px-4 text-center">AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody>
            {% for item in itens %}
              <tr class="border-b border-[#eee] hover:bg-[#f8f3ed] transition">
                <td class="py-3 px-4 font-medium text-[#3c2a1e]">
                  {{ item.produto.name }}
                </td>
                <td class="py-3 px-4 text-[#5b4634] flex items-center gap-2">
                  <a href="{% url 'diminuir_quantidade' item.produto.id_product %}"
                     class="bg-[#b89a7e] text-white px-2 py-1 rounded hover:bg-[#a38369]">âˆ’</a>
                  <span class="font-semibold">{{ item.quantidade }}</span>
                  <a href="{% url 'aumentar_quantidade' item.produto.id_product %}"
                     class="bg-[#6f4e37] text-white px-2 py-1 rounded hover:bg-[#8b5e3c]">+</a>
                </td>
                <td class="py-3 px-4 font-semibold text-[#6f4e37]">
                  R$ {{ item.subtotal|floatformat:2 }}
                </td>
                <td class="py-3 px-4 text-center">
                  <a href="{% url 'remover_produto' item.produto.id_product %}"
                     class="text-red-600 font-medium hover:underline">Remover</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="mt-6">
        <form method="post" class="flex flex-col sm:flex-row gap-3 items-center mt-4">
          {% csrf_token %}
          <label class="text-[#4b2e1e] font-medium">Recalcular frete (CEP):</label>
          <input type="text" name="cep" maxlength="9" value="{{ cep }}" required
                 class="border border-[#b89a7e] rounded-lg px-4 py-2 focus:ring-2 focus:ring-[#6f4e37] outline-none" />
          <button type="submit"
                  class="bg-[#6f4e37] hover:bg-[#8b5e3c] text-white px-5 py-2 rounded-lg transition">
            Calcular
          </button>
        </form>

  {% if frete %}
    <p>ðŸšš Frete: R$ {{ frete|floatformat:2 }}</p>
    <p><small>CEP usado: {{ cep }}</small></p>
  {% else %}
    <form method="post">
      {% csrf_token %}
      <label>Calcular frete (CEP):</label>
      <input type="text" name="cep" maxlength="9" required>
      <button type="submit">Calcular</button>
    </form>
  {% endif %}

  <p><strong>Total: R$ {{ total|floatformat:2 }}</strong></p>

  <br>
  <a href="{% url 'listar_produtos' %}">Continuar comprando</a>

  {% if request.session.user_id %}
    <br><br>
    <a href="{% url 'finalizar_pedido' %}" class="btn btn-success">Finalizar Pedido</a>
  {% else %}
    <p>Para finalizar a compra, faÃ§a <a href="{% url 'login' %}">login</a>.</p>
  {% endif %}

    {% else %}
      <div class="text-center py-20">
        <p class="text-[#6b4a35] text-lg mb-4">Seu carrinho estÃ¡ vazio â˜•</p>
        <a href="{% url 'listar_produtos' %}"
           class="inline-block bg-[#6f4e37] hover:bg-[#8b5e3c] text-white px-6 py-3 rounded-lg font-medium transition">
          Voltar Ã  loja
        </a>
      </div>
    {% endif %}
  </div>
</div>

</body>
</html>
